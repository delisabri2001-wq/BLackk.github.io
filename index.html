<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLack World | Community</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üåø">
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* --- TEMA GIARDINO (VERDE BASE + PASTELLI CALDI) --- */
        :root { 
            --primary: #1b4332; /* Verde Foresta */
            --accent: #2d6a4f;  /* Verde Smeraldo */
            --bg: #f8fff9;      /* Sfondo chiarissimo */
            --white: #ffffff; 
            --text: #1b4332; 
            
            /* PASTELLI PER I MATCH E GIOCHI */
            --cream: #fff5e6;   /* Crema per le card */
            --peach: #ffdab9;   /* Pesca */
            --red-love: #ff4757; /* ROSSO CUORE */
            --lilac: #e6cff2;
        }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { 
            margin: 0; 
            color: var(--text); 
            overflow-x: hidden; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            background-color: var(--bg);
            /* Texture pallini verdi delicati */
            background-image: radial-gradient(#b7e4c7 1.5px, transparent 1.5px), radial-gradient(#b7e4c7 1.5px, var(--bg) 1.5px);
            background-size: 24px 24px;
            background-position: 0 0, 12px 12px;
        }

        /* HEADER & NAV */
        header { background: linear-gradient(135deg, #1b4332, #40916c); color: white; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(27, 67, 50, 0.2); position: relative; z-index: 1001; border-bottom: 5px solid #74c69d; }
        nav { background: rgba(255,255,255,0.95); border-bottom: 1px solid #d8f3dc; display: flex; justify-content: center; position: sticky; top: 0; z-index: 1000; height: 60px; backdrop-filter: blur(5px); }
        .nav-links { display: flex; align-items: center; gap: 10px; overflow-x: auto; padding: 0 10px; }
        .nav-links a { text-decoration: none; color: var(--primary); font-weight: 600; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; padding: 8px 15px; transition: 0.3s; white-space: nowrap; border-radius: 20px; }
        .nav-links a.active { background: var(--primary); color: white; box-shadow: 0 3px 10px rgba(27, 67, 50, 0.2); }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -100%; top: 0; width: 300px; height: 100%; background: white; z-index: 2000; transition: 0.4s; padding: 20px; box-shadow: 5px 0 25px rgba(0,0,0,0.1); overflow-y: auto; border-right: 4px solid #d8f3dc; }
        .sidebar.open { left: 0; }
        #sidebarOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(27, 67, 50, 0.5); z-index:1500; cursor:pointer; }
        
        /* CONTENUTO */
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; flex: 1; width: 100%; position: relative; z-index: 1; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e8f5e9; }
        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BACHECA SCLERI (POST-IT COLORATI) --- */
        .board-container { display: flex; flex-wrap: wrap; gap: 25px; justify-content: center; padding: 20px 0; }
        .post-it { 
            width: 170px; height: 170px; padding: 15px; 
            box-shadow: 4px 4px 15px rgba(0,0,0,0.15); 
            font-family: 'Indie Flower', cursive; font-size: 1.15rem; color: #2d3436;
            display: flex; flex-direction: column; justify-content: space-between;
            transition: transform 0.2s; cursor: default; position: relative;
            border-bottom-right-radius: 40px 5px;
        }
        .post-it:hover { transform: scale(1.15) !important; z-index: 10; box-shadow: 5px 10px 20px rgba(0,0,0,0.2); }
        .post-it b { display: block; font-size: 0.85rem; text-align: right; opacity: 0.7; margin-top: 5px; font-family: 'Poppins', sans-serif; }
        .pin { position: absolute; top: -8px; left: 50%; transform: translateX(-50%); width: 12px; height: 12px; background: #e74c3c; border-radius: 50%; box-shadow: 1px 1px 3px rgba(0,0,0,0.3); }

        /* HOME: FOUNDER CORNER */
        .founder-box { display: flex; gap: 20px; align-items: center; background: #fff; border: 3px dashed var(--accent); padding: 20px; border-radius: 20px; margin-bottom: 30px; }
        .founder-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .founder-text h3 { margin: 0 0 5px 0; color: var(--primary); }
        .founder-text p { margin: 0; font-size: 0.9rem; color: #555; font-style: italic; }

        /* --- TINDER STYLE BASE --- */
        .tinder-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 500px; position: relative; }
        .swipe-card { 
            width: 100%; max-width: 350px; 
            background: white; border-radius: 25px; overflow: hidden; 
            box-shadow: 0 15px 40px rgba(27, 67, 50, 0.15); 
            position: relative; transition: transform 0.4s ease-out, opacity 0.4s ease-out; 
            display: flex; flex-direction: column; border: 1px solid #f0f0f0;
        }
        .swipe-img-container { width: 100%; height: 380px; position: relative; background: #eee; }
        .swipe-img { width: 100%; height: 100%; object-fit: cover; }
        
        .swipe-info { 
            padding: 20px; text-align: left; 
            background: linear-gradient(to bottom, #fff, var(--cream)); 
            border-top: 1px solid #ffeaa7;
        }
        .swipe-name { font-size: 1.8rem; font-weight: bold; margin: 0; color: #2d3436; }
        .swipe-ship { 
            color: #d35400; font-weight: bold; 
            background: #ffeaa7; padding: 3px 10px; border-radius: 12px; 
            font-size: 0.9rem; margin-top: 5px; display: inline-block;
        }
        
        .swipe-controls { display: flex; gap: 30px; justify-content: center; margin-top: 25px; }
        .btn-swipe { width: 70px; height: 70px; border-radius: 50%; border: none; font-size: 2rem; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; }
        
        .btn-swipe.nope { background: white; color: #b2bec3; border: 2px solid #dfe6e9; }
        .btn-swipe.love { background: var(--red-love); color: white; border: 2px solid var(--red-love); box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4); }
        .btn-swipe:hover { transform: scale(1.15); }

        /* MATCH LIST (CERCHI COLORATI) */
        .match-scroller { display: flex; gap: 15px; overflow-x: auto; padding: 15px 0; }
        .match-item { text-align: center; width: 85px; transition: transform 0.2s; }
        .match-item:hover { transform: scale(1.05); }
        .match-avatar-circle { width: 75px; height: 75px; border-radius: 50%; object-fit: cover; border: 3px solid var(--lilac); cursor: pointer; background:white; }
        .match-name { font-size: 0.8rem; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; margin-top: 5px; cursor: pointer; color: var(--primary); text-decoration: underline; }

        /* CHAT STYLES */
        .chat-container { height: 350px; overflow-y: auto; border: 1px solid #d8f3dc; padding: 15px; background: #fff; border-radius: 15px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; box-shadow: inset 0 0 10px rgba(0,0,0,0.03); }
        .msg { padding: 10px 14px; border-radius: 15px; background: #f1f2f6; border: 1px solid #dfe6e9; max-width: 80%; font-size: 0.9rem; word-wrap: break-word; position: relative; color: #000; }
        .msg.me { align-self: flex-end; background: var(--primary); color: white; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .msg.guest { background: #fff5ba; border: 1px solid #ffeaa7; color: #555; }
        .msg.admin { border: 2px solid #ff7675; background: #fff0f0; color: #d63031; }
        .delete-btn { color: #c0392b; font-weight: bold; cursor: pointer; margin-left: 10px; font-size: 0.8rem; }

        /* PROFILO FULL */
        .profile-card { text-align: center; padding: 0; overflow: hidden; }
        .profile-cover { height: 160px; background: linear-gradient(45deg, #1b4332, #81ecec); }
        .profile-avatar-big { width: 150px; height: 150px; border-radius: 50%; border: 6px solid white; margin-top: -80px; position: relative; z-index: 2; object-fit: cover; background: white; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .profile-content { padding: 15px 20px 30px; }
        .ship-tag { background: #ffeaa7; color: #d35400; padding: 6px 14px; border-radius: 25px; font-size: 0.95rem; font-weight: bold; display: inline-block; margin: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .other-ship-tag { background: #cbf0f8; color: #0984e3; padding: 5px 10px; border-radius: 20px; font-size: 0.85rem; display: inline-block; margin: 3px; }
        
        /* EDIT PROFILE */
        .edit-input { width: 100%; border: 2px solid var(--accent); padding: 8px; border-radius: 8px; margin-bottom: 5px; display: none; }
        .editing .edit-input { display: block; }
        .editing .view-data { display: none; }

        /* INPUT & BUTTONS */
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #b7e4c7; border-radius: 12px; margin-bottom: 10px; outline: none; transition: 0.3s; background: #fdfdfd; }
        input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.1); }
        .btn-main { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 5px; transition: 0.2s; box-shadow: 0 4px 6px rgba(45, 106, 79, 0.2); }
        .btn-main:hover { background: #145942; transform: translateY(-2px); }
        .btn-social { background: white; border: 1px solid #b7e4c7; padding: 10px; width: 100%; margin-top: 5px; cursor: pointer; border-radius: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: bold; color: var(--primary); }

        /* GAMES (BOTTONI COLORATI) */
        .game-btn-gmm { background: #ffccd5; color: #d63031; border: 1px solid #ffb7b2; } /* Rosa */
        .game-btn-dmd { background: #cbf0f8; color: #0984e3; border: 1px solid #a2d9e8; } /* Blu */
        .game-btn-emo { background: #ffeaa7; color: #d35400; border: 1px solid #fdcb6e; } /* Giallo */
        .game-btn-slot { background: #d8f3dc; color: #1b4332; border: none; } /* Verde */

        .quiz-btn { width: 100%; padding: 15px; border: 1px solid #ddd; background: #fff; text-align: left; margin-bottom: 10px; cursor: pointer; border-radius: 15px; transition:0.2s; font-weight:600; }
        .quiz-btn:hover { background: #f0f0f0; transform:translateX(5px); }
        .quiz-btn.correct { background: #d8f3dc; color: #1b4332; border-color:#2d6a4f; }
        .quiz-btn.wrong { background: #ffccd5; color: #c0392b; border-color:#ff7675; }
        
        .slot-box { background: white; color: #333; padding: 20px; border-radius: 25px; text-align: center; border: 4px solid var(--peach); margin-top: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .slot-result { font-size: 1.2rem; margin: 15px 0; min-height: 50px; font-weight: bold; color: #e91e63; }

        /* FOOTER */
        footer { background: #1b4332; color: #95d5b2; padding: 30px 20px; text-align: center; font-size: 0.85rem; margin-top: auto; }
        footer a { color: white; text-decoration: underline; cursor: pointer; margin: 0 10px; }
        
        /* ALERTS */
        #toast { visibility: hidden; min-width: 250px; background-color: var(--primary); color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 4000; left: 50%; bottom: 30px; transform: translateX(-50%); box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 0.9rem; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        #toast.success { background-color: #27ae60; }
        #toast.error { background-color: #c0392b; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        #legalModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:5000; align-items:center; justify-content:center; backdrop-filter: blur(3px); }
        .modal-content { background:white; padding:30px; border-radius: 15px; max-width:500px; width:90%; max-height:80vh; overflow-y:auto; position:relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .close-modal { position:absolute; top:15px; right:20px; font-size:1.5rem; cursor:pointer; color:#777; }

        /* DECORAZIONE */
        .cat-sticker { position: fixed; bottom: 20px; right: 20px; width: 80px; z-index: 3000; pointer-events: none; opacity: 0.9; }

        /* --- NUOVO STILE MATCH PASTELLO (Override) --- */
        #match .card:first-child {
            background: #fff5e6 !important; /* Crema */
            border: 2px dashed var(--peach) !important;
        }
        #match h3 {
            color: #e056fd !important; /* Titolo Viola/Fucsia */
        }
        #match p {
            color: #636e72 !important;
        }
        #shipFilter {
            border: 2px solid var(--lilac) !important;
            color: #6c5ce7 !important;
        }
        .swipe-card {
            border: 4px solid var(--lilac) !important; 
            box-shadow: 0 20px 50px rgba(230, 207, 242, 0.6) !important; 
        }
        .swipe-info {
            background: linear-gradient(to bottom, #ffffff 0%, #ffeaa7 100%) !important; 
            border-top: 3px dotted #fdcb6e !important; 
        }
        .swipe-name {
            color: #d63031 !important; 
        }
        #myMatchesContainer {
            background: #f3e5f5 !important; 
            border: 2px solid #e1bee7 !important; 
        }
        #myMatchesContainer h3 {
            color: #9c88ff !important; 
        }
    </style>
</head>
<body>

<header><h1>BLACK WORLD üåø</h1></header>

<nav>
    <div style="position: absolute; left: 20px; top: 18px; cursor: pointer; font-weight: bold; color: var(--primary);" onclick="toggleSidebar()">
        ‚öôÔ∏è MENU
    </div>
    <div class="nav-links">
        <a onclick="navTo('home', this)" class="active">Home</a>
        <a onclick="navTo('bacheca', this)">Scleri üì¢</a>
        <a onclick="navTo('match', this)">Match üî•</a>
        <a onclick="navTo('chat', this)">Chat</a>
        <a onclick="navTo('giochi', this)">Giochi</a>
    </div>
</nav>

<img src="https://emojicdn.elk.sh/üê±" class="cat-sticker">

<div id="sidebarOverlay" onclick="toggleSidebar(true)"></div>
<div class="sidebar" id="sidebar">
    <div style="text-align:right; cursor:pointer; font-size: 1.2rem; color:#888;" onclick="toggleSidebar(true)">‚úï CHIUDI (ESC)</div>
    <div id="authArea">
        <h3>Accedi</h3>
        <p>Entra per personalizzare il profilo e usare i Match!</p>
        <button class="btn-social" onclick="socialLogin()"><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="18"> Google</button>
        <hr style="margin: 20px 0;">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="pass" placeholder="Password">
        <button class="btn-main" onclick="emailAuth('login')">ENTRA</button>
        <button class="btn-main" style="background:#b2bec3; color:#2d3436;" onclick="emailAuth('reg')">REGISTRATI</button>
    </div>
    <div id="userArea" style="display:none;">
        <h3 style="text-align:center;">Ciao, <span id="sidebarNick">User</span>! <span id="adminBadge" style="display:none;">üëë</span></h3>
        <button class="btn-main" onclick="openMyProfile()">üë§ VAI AL MIO PROFILO</button>
        <hr style="margin:20px 0;">
        <button class="btn-main" style="background:#e74c3c;" onclick="logout()">LOGOUT</button>
    </div>
</div>

<div class="container">
    
    <section id="home" class="page active">
        <div class="founder-box">
            <img src="https://ui-avatars.com/api/?name=Founder&background=ffccd5&color=d63031" class="founder-img">
            <div class="founder-text">
                <h3>L'Angolo della Founder üåø</h3>
                <p>"Ciao! Benvenuta nel mio mondo. Ho creato questo blog perch√© volevo uno spazio sicuro per noi fangirl italiane dove sclerare su GMMTV e Domundi senza giudizi. Qui puoi trovare amiche che capiscono la tua ossessione per i BL! Divertiti e fai tanti match! üíö"</p>
            </div>
        </div>

        <div class="card" style="text-align:center; padding:40px; border:2px solid var(--peach);">
            <h2 style="color:var(--primary);">Benvenuta in BLack World üåø</h2>
            <p style="font-size:1.1rem; color:#555;">La community per fangirl aggiornata al 2025.</p>
            <button class="btn-main" style="max-width:300px; background:var(--accent);" onclick="navTo('match')">üî• TROVA LA TUA SHIP FRIEND</button>
        </div>
    </section>

    <section id="bacheca" class="page">
        <div class="card" style="text-align:center; background:#fffbe7; border: 2px dashed #f1c40f;">
            <h3 style="color:#d35400;">üì¢ Bacheca degli Scleri</h3>
            <p>Lascia un pensiero anonimo (o firmato) sulla tua serie preferita!</p>
            <textarea id="scleroInput" rows="3" placeholder="Scrivi qui il tuo sclero..." style="background:white;"></textarea>
            <button class="btn-main" style="background:#f39c12;" onclick="postSclero()">üìå APPENDI POST-IT</button>
        </div>
        <div id="scleroBoard" class="board-container">
            <div style="color:#888;">Caricamento scleri...</div>
        </div>
    </section>

    <section id="userProfilePage" class="page">
        <div class="card profile-card" id="profileCardContent">
            <div class="profile-cover"></div>
            <img id="pubAvatar" src="" class="profile-avatar-big">
            <div class="profile-content">
                <div class="view-data">
                    <h2 id="pubNick" style="margin:0; color:var(--primary);">Nome</h2>
                    <div style="margin-top:10px;"><span class="ship-tag">üèÜ Main: <span id="pubShip">...</span></span></div>
                    <div style="margin-top:5px;" id="pubOtherShipsContainer"></div>
                    <div style="margin: 20px 0; font-size:1.1rem; color:#555;">Et√†: <b id="pubAge">-</b></div>
                    <div style="font-style:italic; color:#2d6a4f; margin:20px 0; padding:10px; background:#f0fff4; border-radius:8px;">"<span id="pubStory">...</span>"</div>
                    <div style="margin-top:10px;">üì± Social: <b id="pubSocial">-</b></div>
                </div>
                <div class="edit-input">
                    <label>Cambia Foto:</label><input type="file" id="editFile" accept="image/*">
                    <input type="text" id="editNick" placeholder="Nome"><input type="number" id="editAge" placeholder="Et√†">
                    <input type="text" id="editShip" placeholder="Ship Main"><input type="text" id="editOther" placeholder="Altre Ship">
                    <input type="text" id="editSocial" placeholder="Social"><textarea id="editStory" rows="3" placeholder="Bio"></textarea>
                </div>
                <button id="btnEditProfile" class="btn-main" style="background:#40916c; margin-top:20px; display:none;" onclick="toggleProfileEdit()">‚úèÔ∏è MODIFICA PROFILO</button>
                <button id="btnSaveProfile" class="btn-main" style="background:#40916c; margin-top:20px; display:none;" onclick="saveProfileFromPage()">üíæ SALVA</button>
                <button class="btn-social" style="margin-top:20px;" onclick="navTo('home')">üîô Torna alla Home</button>
            </div>
        </div>
    </section>

    <section id="match" class="page">
        <div class="card" style="text-align:center; padding:15px;">
            <h3 style="margin:0 0 10px 0; color:var(--primary);">üíò Swipe & Match</h3>
            <p style="font-size:0.9rem; color:#666;">Filtra per ship (es. PerthSanta...)</p>
            <input type="text" id="shipFilter" placeholder="üîç Scrivi ship..." onkeyup="reloadDeck()" style="text-align:center; font-weight:bold; color:var(--primary);">
        </div>
        <div id="deckContainer" class="tinder-container"><div id="loadingDeck" style="text-align:center; color:#888;">Caricamento profili...</div></div>
        <div id="myMatchesContainer" class="card" style="display:none;">
            <h3 style="color:var(--primary);">I Miei Match üíö</h3>
            <p style="font-size:0.8rem; color:#666;">Clicca FOTO per Profilo | Clicca NOME per Chat</p>
            <div id="matchList" class="match-scroller"></div>
        </div>
        <div id="guestWarning" class="card" style="text-align:center; background:#e8f5e9; display:none;"><small>üí° Accedi per salvare i Match e chattare!</small></div>
    </section>

    <section id="privateChat" class="page">
        <div class="card" style="border: 2px solid #52b788;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="color:var(--primary); margin:0;">üí¨ Chat con <span id="privateChatName">Utente</span></h3>
                <button onclick="navTo('match')" style="background:none; border:none; cursor:pointer; color:#e74c3c;">‚ùå Chiudi</button>
            </div>
            <div id="privateChatBox" class="chat-container"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="privateChatInput" placeholder="Scrivi... (Enter)" onkeydown="if(event.key==='Enter') sendPrivateMsg()">
                <button class="btn-main" style="width:80px; margin:0;" onclick="sendPrivateMsg()">Invia</button>
            </div>
        </div>
    </section>

    <section id="chat" class="page">
        <div class="card" style="border: 2px solid var(--primary);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="color:var(--primary); margin:0;">‚ú® Global Chat</h3>
            </div>
            <div id="chatBox" class="chat-container"></div>
            <div id="chatControls" style="display:flex; flex-direction:column; gap:10px;">
                <input type="text" id="guestNick" placeholder="Il tuo nome (Obbligatorio per Ospiti)" style="display:none; border:2px solid #52b788;">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="chatInput" placeholder="Scrivi... (Enter)" onkeydown="if(event.key==='Enter') sendMsg()">
                    <button class="btn-main" style="width:80px; margin:0;" onclick="sendMsg()">Invia</button>
                </div>
            </div>
        </div>
    </section>

    <section id="giochi" class="page">
        <div id="quizMenu" class="card">
            <h3 style="color:var(--primary);">üéÆ Sala Giochi</h3>
            <button class="btn-main game-btn-gmm" onclick="startQuiz('gmmtv')">üè¢ Quiz GMMTV (2025)</button>
            <button class="btn-main game-btn-dmd" onclick="startQuiz('domundi')">üêâ Quiz DOMUNDI (2025)</button>
            <button class="btn-main game-btn-emo" onclick="startEmojiGame()">üß© Emoji Challenge: Serie TV</button>
            <div class="slot-box"><h3 style="color:var(--primary); margin:0;">üé∞ La Ruota dell'Amore</h3><p>Quale ship 2025 ti protegge?</p><div id="slotResult" class="slot-result">‚ùì</div><button class="btn-main game-btn-slot" onclick="spinSlot()">GIRA ORA</button></div>
        </div>
        <div id="quizActive" class="card" style="display:none;"><button onclick="stopQuiz()" style="float:right; border:none; background:none; color:#e74c3c;">‚úï</button><h3 id="qTitle">Domanda</h3><p id="qText" style="font-size:1.2rem; font-weight:600;">...</p><div id="qOpts"></div><p id="qFeed" style="font-weight:bold; text-align:center; margin-top:10px;"></p></div>
    </section>

</div>

<footer><p>¬© 2024 Black World Community</p><div><a onclick="openLegal('privacy')">Privacy</a> <a onclick="openLegal('terms')">Termini</a> <a onclick="document.cookie='bw_consent=; Max-Age=0'; location.reload();">Reset</a></div></footer>

<div id="legalModal"><div class="modal-content"><span class="close-modal" onclick="document.getElementById('legalModal').style.display='none'">&times;</span><h3 id="legalTitle">Titolo</h3><div id="legalContent"></div></div></div>
<div id="toast">Notifica</div>
<div id="cookieBanner" style="position:fixed; bottom:0; left:0; width:100%; background:#1b4332; color:white; padding:15px; text-align:center; z-index:5000; display:none;">üç™ Cookie tecnici. <button onclick="acceptCookies()" style="margin-left:15px; background:#52b788; border:none; padding:5px 15px; color:white; cursor:pointer;">OK</button></div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script>
    // --- CHIAVI FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyAr4cM8wb7kSHpaFDGjlDZcm15t1LyL4Do",
        authDomain: "black-world-91efc.firebaseapp.com",
        databaseURL: "https://black-world-91efc-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "black-world-91efc",
        storageBucket: "black-world-91efc.firebasestorage.app",
        messagingSenderId: "1075556185722",
        appId: "1:1075556185722:web:a18a5f3d7ef3b4862aedc3",
        measurementId: "G-L1TH722CGE"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const ADMIN_EMAILS = ["delisabri@outlook.it", "delisabri2001@gmail.com"];

    // UTILS
    function showToast(msg, type='info') {
        const t = document.getElementById('toast');
        t.innerText = msg; t.className = 'show ' + type;
        setTimeout(()=>t.className=t.className.replace('show',''), 3000);
    }
    
    function navTo(pageId, linkRef) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if(linkRef) {
            document.querySelectorAll('.nav-links a').forEach(a=>a.classList.remove('active'));
            linkRef.classList.add('active');
        }
        if(window.innerWidth<=768) toggleSidebar(true); 
    }

    function toggleSidebar(forceClose) {
        const s = document.getElementById('sidebar');
        const o = document.getElementById('sidebarOverlay');
        if(forceClose || s.classList.contains('open')) { s.classList.remove('open'); o.style.display='none'; }
        else { s.classList.add('open'); o.style.display='block'; }
    }
    
    // AUTH
    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('authArea').style.display='none';
            document.getElementById('userArea').style.display='block';
            document.getElementById('guestWarning').style.display='none';
            
            db.ref('users/'+u.uid).on('value', s => {
                const d = s.val() || {};
                const nick = d.nick || u.email.split('@')[0];
                document.getElementById('sidebarNick').innerText = nick;
                document.getElementById('guestNick').style.display='none';
                if(ADMIN_EMAILS.includes(u.email)) {
                    document.getElementById('adminBadge').style.display='inline';
                }
            });
            loadDeck(); loadMyMatches();
        } else {
            document.getElementById('authArea').style.display='block';
            document.getElementById('userArea').style.display='none';
            document.getElementById('guestWarning').style.display='block';
            document.getElementById('guestNick').style.display='block';
        }
        loadChat(); loadScleri(); checkCookie();
    });

    function emailAuth(mode) {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        if(!e || !p) return showToast('Inserisci Email e Password', 'error');
        if(mode==='reg') {
            auth.createUserWithEmailAndPassword(e,p).then(()=>{
                showToast('Benvenuta! Ora imposta il profilo.'); openMyProfile();
            }).catch(err=>showToast(err.message,'error'));
        } else {
            auth.signInWithEmailAndPassword(e,p).then(()=>showToast('Bentornata!')).catch(err=>showToast(err.message,'error'));
        }
    }
    function socialLogin() {
        const p = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(p).then(()=>showToast('Login Google OK')).catch(e=>showToast(e.message,'error'));
    }
    function logout() { auth.signOut().then(()=>window.location.reload()); }

    // PROFILO
    let myProfileData = {};
    function openMyProfile() {
        if(!auth.currentUser) return showToast('Devi essere loggata!','error');
        navTo('userProfilePage');
        document.getElementById('btnEditProfile').style.display='block';
        document.getElementById('btnSaveProfile').style.display='none';
        document.querySelector('.profile-card').classList.remove('editing');
        
        db.ref('users/'+auth.currentUser.uid).once('value', s => {
            myProfileData = s.val() || {};
            renderProfile(myProfileData);
        });
    }

    function renderProfile(d) {
        document.getElementById('pubAvatar').src = d.avatar || `https://ui-avatars.com/api/?name=${d.nick||'U'}&background=random`;
        document.getElementById('pubNick').innerText = d.nick || 'Utente';
        document.getElementById('pubShip').innerText = d.ship || 'Nessuna';
        document.getElementById('pubAge').innerText = d.age || '-';
        document.getElementById('pubSocial').innerText = d.social || '-';
        document.getElementById('pubStory').innerText = d.bio || 'Scrivi la tua bio...';
        
        const c = document.getElementById('pubOtherShipsContainer'); c.innerHTML='';
        if(d.otherShips) d.otherShips.split(',').forEach(x=> c.innerHTML+=`<span class="other-ship-tag">${x.trim()}</span>`);
    }

    function toggleProfileEdit() {
        document.querySelector('.profile-card').classList.add('editing');
        document.getElementById('btnEditProfile').style.display='none';
        document.getElementById('btnSaveProfile').style.display='block';
        // Fill inputs
        document.getElementById('editNick').value = myProfileData.nick||'';
        document.getElementById('editAge').value = myProfileData.age||'';
        document.getElementById('editShip').value = myProfileData.ship||'';
        document.getElementById('editOther').value = myProfileData.otherShips||'';
        document.getElementById('editSocial').value = myProfileData.social||'';
        document.getElementById('editStory').value = myProfileData.bio||'';
    }

    async function saveProfileFromPage() {
        const f = document.getElementById('editFile').files[0];
        let avatarUrl = myProfileData.avatar;

        if(f) {
            const reader = new FileReader();
            reader.readAsDataURL(f);
            reader.onload = function () {
                saveDataFinal(reader.result);
            };
            reader.onerror = function (error) {
                console.log('Error: ', error);
            };
        } else {
            saveDataFinal(avatarUrl);
        }
    }

    function saveDataFinal(avatarUrl) {
        const data = {
            nick: document.getElementById('editNick').value,
            age: document.getElementById('editAge').value,
            ship: document.getElementById('editShip').value,
            otherShips: document.getElementById('editOther').value,
            social: document.getElementById('editSocial').value,
            bio: document.getElementById('editStory').value,
            avatar: avatarUrl || ''
        };
        db.ref('users/'+auth.currentUser.uid).update(data).then(()=>{
            showToast('Profilo salvato!', 'success');
            openMyProfile(); // Reload view
        });
    }

    // BACHECA SCLERI
    function postSclero() {
        const txt = document.getElementById('scleroInput').value;
        if(!txt) return;
        const note = { text: txt, date: Date.now(), author: auth.currentUser ? (auth.currentUser.displayName||'Utente') : 'Anonima' };
        db.ref('scleri').push(note);
        document.getElementById('scleroInput').value='';
    }
    function loadScleri() {
        db.ref('scleri').limitToLast(20).on('value', s => {
            const b = document.getElementById('scleroBoard'); b.innerHTML='';
            s.forEach(c => {
                const v = c.val();
                const colors = ['#ffeaa7','#fab1a0','#81ecec','#74b9ff','#a29bfe'];
                const col = colors[Math.floor(Math.random()*colors.length)];
                b.innerHTML = `<div class="post-it" style="background:${col}; transform:rotate(${Math.random()*10-5}deg);">
                    <div class="pin"></div>
                    <div style="overflow:hidden; max-height:110px;">${v.text}</div>
                    <b>- ${v.author}</b>
                </div>` + b.innerHTML;
            });
        });
    }

    // MATCH SYSTEM (TINDER STYLE)
    let potentialMatches = [];
    let currentCardIdx = 0;

    function loadDeck() {
        if(!auth.currentUser) return;
        document.getElementById('loadingDeck').style.display='block';
        
        db.ref('users').once('value', s => {
            const all = s.val() || {};
            const me = auth.currentUser.uid;
            potentialMatches = Object.keys(all).filter(k => k !== me).map(k => ({id:k, ...all[k]}));
            reloadDeck();
        });
    }

    function reloadDeck() {
        const filter = document.getElementById('shipFilter').value.toLowerCase();
        let list = potentialMatches;
        if(filter) list = list.filter(u => (u.ship && u.ship.toLowerCase().includes(filter)) || (u.otherShips && u.otherShips.toLowerCase().includes(filter)));
        
        // Remove already matched/swiped (simplified for demo: just local storage check or basic)
        // In real app: fetch swipes from DB. Here we just show random shuffle.
        list.sort(() => Math.random() - 0.5);
        
        const c = document.getElementById('deckContainer');
        c.innerHTML = '';
        
        if(list.length === 0) {
            c.innerHTML = '<div style="text-align:center; padding:20px;">Nessun profilo trovato con questa ship :(</div>';
            return;
        }

        list.forEach(u => {
            const card = document.createElement('div');
            card.className = 'swipe-card';
            // Use avatar or placeholder
            const img = u.avatar || `https://ui-avatars.com/api/?name=${u.nick||'?'}&background=random`;
            
            card.innerHTML = `
                <div class="swipe-img-container">
                    <img src="${img}" class="swipe-img">
                </div>
                <div class="swipe-info">
                    <h3 class="swipe-name">${u.nick || 'Sconosciuta'} <span style="font-size:1rem; font-weight:normal;">${u.age||''}</span></h3>
                    <div class="swipe-ship">‚öì ${u.ship || 'Multiship'}</div>
                    <p style="color:#666; font-size:0.9rem; margin-top:5px;">${u.bio || 'Nessuna bio.'}</p>
                    <div class="swipe-controls">
                        <button class="btn-swipe nope" onclick="swipe(this, 'left')">‚úñÔ∏è</button>
                        <button class="btn-swipe love" onclick="swipe(this, 'right', '${u.id}', '${u.nick}', '${img}')">‚ù§Ô∏è</button>
                    </div>
                </div>
            `;
            c.appendChild(card);
        });
        
        // Stack logic: only show top one
        updateStack();
    }

    function updateStack() {
        const cards = document.querySelectorAll('.swipe-card');
        cards.forEach((c, i) => {
            if(i===0) c.style.display = 'flex';
            else c.style.display = 'none';
        });
    }

    function swipe(btn, dir, uid, nick, img) {
        const card = btn.closest('.swipe-card');
        card.style.transform = `translate(${dir==='left'?'-100%':'100%'}, -20px) rotate(${dir==='left'?'-20deg':'20deg'})`;
        card.style.opacity = '0';
        
        setTimeout(() => {
            card.remove();
            updateStack();
        }, 300);

        if(dir === 'right' && auth.currentUser) {
            // Create Match in DB
            const matchData = {
                timestamp: Date.now(),
                withUser: uid,
                withNick: nick,
                withAvatar: img
            };
            // Save to my matches
            db.ref('users/'+auth.currentUser.uid+'/matches/'+uid).set(matchData);
            // Save to their matches (reciprocal for simplicity demo)
            db.ref('users/'+uid+'/matches/'+auth.currentUser.uid).set({
                 timestamp: Date.now(),
                 withUser: auth.currentUser.uid,
                 withNick: document.getElementById('sidebarNick').innerText,
                 withAvatar: myProfileData.avatar || ''
            });
            showToast(`Match con ${nick}!`, 'success');
        }
    }

    function loadMyMatches() {
        db.ref('users/'+auth.currentUser.uid+'/matches').on('value', s => {
            const c = document.getElementById('matchList');
            const box = document.getElementById('myMatchesContainer');
            if(!s.exists()) { box.style.display='none'; return; }
            
            box.style.display='block';
            c.innerHTML = '';
            s.forEach(m => {
                const v = m.val();
                c.innerHTML += `
                <div class="match-item">
                    <img src="${v.withAvatar}" class="match-avatar-circle" onclick="viewUserProfile('${v.withUser}')">
                    <span class="match-name" onclick="openPrivateChat('${v.withUser}', '${v.withNick}')">${v.withNick}</span>
                </div>`;
            });
        });
    }

    // CHAT SYSTEM
    function loadChat() {
        const b = document.getElementById('chatBox');
        db.ref('global_chat').limitToLast(50).on('child_added', s => {
            const m = s.val();
            const div = document.createElement('div');
            const isMe = auth.currentUser && m.uid === auth.currentUser.uid;
            const isAdmin = ADMIN_EMAILS.includes(m.email); // Check if admin email
            
            div.className = `msg ${isMe?'me':(isAdmin?'admin':'guest')}`;
            div.innerHTML = `<b>${m.nick}</b>: ${m.text}`;
            
            if(isAdmin && !isMe) { // Allow admin to delete
                // Logic to delete msg (omitted for brevity, requires ID)
            }
            b.appendChild(div);
            b.scrollTop = b.scrollHeight;
        });
    }

    function sendMsg() {
        const txt = document.getElementById('chatInput');
        const gst = document.getElementById('guestNick');
        if(!txt.value) return;
        
        const nick = auth.currentUser ? document.getElementById('sidebarNick').innerText : (gst.value || 'Ospite');
        const msg = {
            text: txt.value,
            nick: nick,
            uid: auth.currentUser ? auth.currentUser.uid : 'guest',
            email: auth.currentUser ? auth.currentUser.email : '',
            ts: Date.now()
        };
        db.ref('global_chat').push(msg);
        txt.value = '';
    }

    // PRIVATE CHAT
    let currentChatPartner = null;
    function openPrivateChat(uid, nick) {
        currentChatPartner = uid;
        navTo('privateChat');
        document.getElementById('privateChatName').innerText = nick;
        loadPrivateChat(uid);
    }
    
    function loadPrivateChat(partnerId) {
        const box = document.getElementById('privateChatBox');
        box.innerHTML = '<div style="text-align:center; color:#888; padding:20px;">Inizio chat criptata üîí</div>';
        
        const chatId = [auth.currentUser.uid, partnerId].sort().join('_');
        db.ref('chats/'+chatId).limitToLast(50).on('child_added', s => {
            const m = s.val();
            const div = document.createElement('div');
            div.className = `msg ${m.uid === auth.currentUser.uid ? 'me' : 'guest'}`;
            div.innerHTML = m.text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function sendPrivateMsg() {
        if(!currentChatPartner) return;
        const txt = document.getElementById('privateChatInput');
        if(!txt.value) return;
        
        const chatId = [auth.currentUser.uid, currentChatPartner].sort().join('_');
        db.ref('chats/'+chatId).push({
            uid: auth.currentUser.uid,
            text: txt.value,
            ts: Date.now()
        });
        txt.value = '';
    }

    // GIOCHI
    const quizzes = {
        gmmtv: [
            { q: "Quale coppia √® protagonista di 'Bad Buddy'?", a: ["OhmNanon", "OffGun", "TayNew"], c: 0 },
            { q: "Chi √® il CEO di GMMTV?", a: ["P'Tha", "P'Aof", "P'X"], c: 0 },
            { q: "In 'Moonlight Chicken', chi vende riso?", a: ["Jim (Earth)", "Wen (Mix)", "Li Ming"], c: 0 }
        ],
        domundi: [
            { q: "Chi sono i protagonisti di 'Cutie Pie'?", a: ["ZeeNuNew", "MaxNat", "TutorYim"], c: 0 },
            { q: "Qual √® la serie horror di DMD?", a: ["Naughty Babe", "Zomvivor", "Middleman's Love"], c: 1 }
        ]
    };
    
    let currentQuizData = [];
    let qI = 0; let pts = 0; let type='';

    function startQuiz(t) {
        currentQuizData = quizzes[t];
        qI = 0; pts = 0; type=t;
        document.getElementById('quizMenu').style.display='none';
        document.getElementById('quizActive').style.display='block';
        showQ();
    }
    
    function startEmojiGame() {
        // Simple emoji quiz
        currentQuizData = [
            { e: "‚öôÔ∏èüë®‚Äçüîß‚ù§Ô∏èü©∫", a: ["SOTUS", "Bad Buddy", "My Gear and Your Gown"], c: 0 },
            { e: "üé∏ü¶Åüê∞", a: ["2gether", "Why R U?", "Love By Chance"], c: 0 }
        ];
        qI = 0; pts = 0; type='';
        document.getElementById('quizMenu').style.display='none';
        document.getElementById('quizActive').style.display='block';
        showQ(); 
    }
    
    function showQ() {
        if(qI>=currentQuizData.length) {
            alert(`Punti: ${pts}/${currentQuizData.length}`);
            if(type) db.ref('users/'+auth.currentUser.uid+'/score').transaction(s=>(s||0)+pts);
            stopQuiz(); return;
        }
        const d = currentQuizData[qI];
        document.getElementById('qTitle').innerText=`Domanda ${qI+1}`;
        document.getElementById('qText').innerHTML=d.e?`<span style="font-size:2rem;">${d.e}</span>`:d.q;
        let options = d.a.map((ans, idx) => ({ text: ans, correct: (idx === d.c) }));
        options.sort(() => Math.random() - 0.5);
        document.getElementById('qOpts').innerHTML=options.map(opt=>`<div class="quiz-btn" onclick="chk(${opt.correct},this)">${opt.text}</div>`).join('');
    }
    
    function chk(isCorrect, e) {
        document.querySelectorAll('.quiz-btn').forEach(b=>b.onclick=null);
        if(isCorrect){ e.classList.add('correct'); pts++; }
        else { e.classList.add('wrong'); }
        setTimeout(()=>{ qI++; showQ(); }, 1000);
    }

    function stopQuiz() {
        document.getElementById('quizActive').style.display='none';
        document.getElementById('quizMenu').style.display='block';
    }

    function spinSlot() {
        const ships = ["OhmNanon", "ZeeNuNew", "OffGun", "FirstKhao", "YinWar", "BounPrem"];
        const res = document.getElementById('slotResult');
        let i = 0;
        const interval = setInterval(() => {
            res.innerText = ships[Math.floor(Math.random()*ships.length)];
            i++;
            if(i>20) {
                clearInterval(interval);
                const win = ships[Math.floor(Math.random()*ships.length)];
                res.innerText = "‚ú® " + win + " ‚ú®";
            }
        }, 50);
    }

    // LEGAL & COOKIES
    function openLegal(t) {
        document.getElementById('legalModal').style.display='flex';
        document.getElementById('legalTitle').innerText = t==='privacy' ? 'Privacy Policy' : 'Termini & Condizioni';
        document.getElementById('legalContent').innerHTML = '<p>Testo legale simulato. Questa √® una community fan-made non a scopo di lucro. Dati salvati su Firebase (Google).</p>';
    }
    function checkCookie() {
        if(!document.cookie.includes('bw_consent=true')) document.getElementById('cookieBanner').style.display='block';
    }
    function acceptCookies() {
        document.cookie = "bw_consent=true; max-age=31536000; path=/";
        document.getElementById('cookieBanner').style.display='none';
    }

</script>
</body>
</html>
