<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLack World | Community & Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1b4332; --accent: #2d6a4f; --soft: #f0f7f4; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background: var(--soft); color: #333; overflow-x: hidden; }

        header { background: var(--primary); color: white; padding: 25px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h1 { margin: 0; letter-spacing: 2px; }

        nav { background: white; border-bottom: 1px solid #ddd; display: flex; justify-content: center; position: sticky; top: 0; z-index: 1000; height: 60px; }
        .nav-links { display: flex; align-items: center; gap: 25px; }
        .nav-links a { text-decoration: none; color: #333; font-weight: 600; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; }
        .nav-links a:hover { color: var(--accent); }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -100%; top: 0; width: 380px; height: 100%; background: white; z-index: 2000; transition: 0.4s; padding: 25px; box-shadow: 5px 0 25px rgba(0,0,0,0.1); overflow-y: auto; }
        .sidebar.open { left: 0; }
        .tab-container { display: flex; margin-bottom: 20px; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; }
        .tab-btn { flex: 1; padding: 12px; border: none; cursor: pointer; background: #f8f9fa; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; }
        
        .auth-form { display: none; }
        .auth-form.active { display: block; }

        .field { margin-bottom: 15px; }
        .field label { display: block; font-size: 0.8rem; font-weight: 600; margin-bottom: 5px; }
        .field input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }

        .btn-main { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-social { background: white; border: 1px solid #ddd; padding: 10px; width: 100%; margin-top: 10px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 600; color: #555; }
        .btn-social img { width: 20px; }

        /* CONTENT */
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .page { display: none; }
        .page.active { display: block; }

        /* CHAT */
        #chatBox { height: 350px; overflow-y: auto; border: 1px solid #eee; padding: 15px; background: #fafafa; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .msg { padding: 10px 15px; border-radius: 12px; background: #eee; max-width: 80%; font-size: 0.9rem; }
        .msg.me { align-self: flex-end; background: var(--accent); color: white; }

        /* QUIZ */
        #quiz-options button { width: 100%; margin-top: 8px; }
        .match-notify { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; border: 1px solid #c3e6cb; font-weight: bold; }
    </style>
</head>
<body>

<header><h1>BLACK WORLD ðŸŒˆ</h1></header>

<nav>
    <div style="position: absolute; left: 20px; top: 18px; cursor: pointer; font-weight: bold;" onclick="toggleSidebar()">â˜° ACCOUNT</div>
    <div class="nav-links">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('amicizia')">Amicizia</a>
        <a onclick="showPage('chat')">Chat</a>
        <a onclick="showPage('giochi')">Giochi</a>
    </div>
</nav>

<div class="sidebar" id="sidebar">
    <div style="text-align:right; cursor:pointer; font-size: 1.2rem;" onclick="toggleSidebar()">âœ•</div>
    
    <div class="tab-container">
        <button class="tab-btn active" id="tabL" onclick="switchAuth('login')">ACCEDI</button>
        <button class="tab-btn" id="tabR" onclick="switchAuth('reg')">REGISTRATI</button>
    </div>

    <div id="loginForm" class="auth-form active">
        <div class="field"><label>Email</label><input type="email" id="lEmail"></div>
        <div class="field"><label>Password</label><input type="password" id="lPass"></div>
        <button class="btn-main" onclick="loginEmail()">ACCEDI</button>
    </div>

    <div id="regForm" class="auth-form">
        <div class="field"><label>Nome o Nickname *</label><input type="text" id="rNome"></div>
        <div class="field"><label>Email *</label><input type="email" id="rEmail"></div>
        <div class="field"><label>Password *</label><input type="password" id="rPass"></div>
        <button class="btn-main" onclick="registerEmail()">CREA ACCOUNT</button>
    </div>

    <hr style="margin:25px 0; border: 0; border-top: 1px solid #eee;">
    
    <button class="btn-social" onclick="socialLogin('google')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Continua con Google
    </button>
    <button class="btn-social" onclick="socialLogin('microsoft')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg"> Continua con Microsoft
    </button>
</div>

<div class="container">
    <section id="home" class="page active">
        <div class="card">
            <h2>Benvenuta nella Community BL ðŸŒ¿</h2>
            <p>Esplora i progetti, partecipa ai quiz e trova nuove amiche con cui sclerare per le tue ship preferite!</p>
        </div>
    </section>

    <section id="amicizia" class="page">
        <div id="matchAlert" class="match-notify"></div>
        <div class="card">
            <h3>Trova il tuo Match BL ðŸ’˜</h3>
            <p style="font-size: 0.85rem; color: #666;">Inserisci la tua ship e scopri chi altro la ama!</p>
            <input type="text" id="pNick" placeholder="Tuo Nickname">
            <input type="text" id="pShip" placeholder="La tua Ship del cuore (es: JoongDunk)">
            <textarea id="pBio" placeholder="Parlaci dei tuoi gusti BL..." rows="3" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ddd; margin-bottom:10px;"></textarea>
            <button class="btn-main" onclick="handleMatch()">CERCA MATCH</button>
        </div>
        <div id="profilesFeed"></div>
    </section>

    <section id="chat" class="page">
        <div class="card">
            <h3>Global Chat ðŸ’¬</h3>
            <div id="chatBox"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chatInput" placeholder="Scrivi un messaggio..." style="flex:1; padding:10px; border-radius:6px; border:1px solid #ddd;">
                <button class="btn-main" style="width:100px; margin:0;" onclick="sendMsg()">Invia</button>
            </div>
        </div>
    </section>

    <section id="giochi" class="page">
        <div class="card">
            <h3>Quiz GMMTV: Sei una vera esperta? ðŸŽ®</h3>
            <div id="quiz-area">
                <p id="q-text" style="font-weight:600;">Pronta a metterti alla prova?</p>
                <div id="quiz-options"></div>
                <button class="btn-main" id="quiz-start" onclick="startQuiz()">INIZIA QUIZ</button>
            </div>
        </div>
    </section>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAr4cM8wb7kSHpaFDGjlDZcm15t1LyL4Do",
      authDomain: "black-world-91efc.firebaseapp.com",
      databaseURL: "https://black-world-91efc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "black-world-91efc",
      storageBucket: "black-world-91efc.firebasestorage.app",
      messagingSenderId: "1075556185722",
      appId: "1:1075556185722:web:a18a5f3d7ef3b4862aedc3",
      measurementId: "G-L1TH722CGE"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // UI LOGIC
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function showPage(id) { 
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function switchAuth(t) {
        document.getElementById('loginForm').classList.toggle('active', t === 'login');
        document.getElementById('regForm').classList.toggle('active', t === 'reg');
        document.getElementById('tabL').classList.toggle('active', t === 'login');
        document.getElementById('tabR').classList.toggle('active', t === 'reg');
    }

    // AUTHENTICATION
    function registerEmail() {
        const e = document.getElementById('rEmail').value;
        const p = document.getElementById('rPass').value;
        auth.createUserWithEmailAndPassword(e, p).then(() => { alert("Benvenuta!"); toggleSidebar(); }).catch(err => alert(err.message));
    }
    function loginEmail() {
        const e = document.getElementById('lEmail').value;
        const p = document.getElementById('lPass').value;
        auth.signInWithEmailAndPassword(e, p).then(() => { toggleSidebar(); }).catch(err => alert(err.message));
    }
    function socialLogin(type) {
        const provider = type === 'google' ? new firebase.auth.GoogleAuthProvider() : new firebase.auth.OAuthProvider('microsoft.com');
        auth.signInWithPopup(provider).then(() => toggleSidebar()).catch(err => alert("Errore: " + err.message));
    }

    // CHAT & PROFILES
    let allProfiles = [];
    auth.onAuthStateChanged(user => {
        if(user) {
            // Chat listener
            db.ref("messages/public").limitToLast(25).on("value", s => {
                const box = document.getElementById('chatBox'); box.innerHTML = "";
                s.forEach(m => {
                    const isMe = m.val().user === user.email;
                    box.innerHTML += `<div class="msg ${isMe ? 'me' : ''}"><b>${m.val().user.split('@')[0]}</b>: ${m.val().text}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
            // Profile listener for match
            db.ref("profiles").on("value", s => { allProfiles = []; s.forEach(p => allProfiles.push(p.val())); });
        }
    });

    function sendMsg() {
        const txt = document.getElementById('chatInput').value;
        if(txt && auth.currentUser) {
            db.ref("messages/public").push({ user: auth.currentUser.email, text: txt });
            document.getElementById('chatInput').value = "";
        } else if(!auth.currentUser) { alert("Accedi per chattare!"); }
    }

    function handleMatch() {
        const nick = document.getElementById('pNick').value;
        const ship = document.getElementById('pShip').value.trim().toLowerCase();
        if(!ship || !auth.currentUser) return alert("Accedi e inserisci la tua ship!");
        
        const match = allProfiles.find(p => p.ship.toLowerCase() === ship && p.nick !== nick);
        const alertBox = document.getElementById('matchAlert');
        alertBox.style.display = "block";
        alertBox.innerHTML = match ? `âœ¨ MATCH! Anche <b>${match.nick}</b> adora questa ship!` : "Profilo salvato! Vediamo chi altro ama questa ship...";
        
        db.ref("profiles/" + auth.currentUser.uid).set({ nick, ship, bio: document.getElementById('pBio').value });
    }

    // QUIZ LOGIC
    const questions = [
        { q: "Chi Ã¨ il partner di Nanon Korapat in 'Bad Buddy'?", a: ["Ohm Pawat", "Chimon", "Drake", "Jimmy"], correct: 0 },
        { q: "Quale ship Ã¨ protagonista di 'Hidden Agenda'?", a: ["JoongDunk", "PondPhuwin", "ForceBook", "FirstKhaotung"], correct: 0 },
        { q: "Chi interpreta Gun in 'My School President'?", a: ["Fourth Nattawat", "Gemini Norawit", "Winny", "Satang"], correct: 0 }
    ];
    let curQ = 0; let quizScore = 0;

    function startQuiz() {
        curQ = 0; quizScore = 0;
        document.getElementById('quiz-start').style.display = 'none';
        renderQuestion();
    }

    function renderQuestion() {
        const data = questions[curQ];
        document.getElementById('q-text').innerText = data.q;
        const optDiv = document.getElementById('quiz-options');
        optDiv.innerHTML = "";
        data.a.forEach((opt, i) => {
            const b = document.createElement('button');
            b.className = "btn-social"; b.innerText = opt;
            b.onclick = () => {
                if(i === data.correct) quizScore++;
                curQ++;
                if(curQ < questions.length) renderQuestion();
                else finishQuiz();
            };
            optDiv.appendChild(b);
        });
    }

    function finishQuiz() {
        document.getElementById('q-text').innerText = `Hai totalizzato ${quizScore} su ${questions.length}!`;
        document.getElementById('quiz-options').innerHTML = "";
        const b = document.getElementById('quiz-start');
        b.style.display = 'block'; b.innerText = "Riprova";
    }
</script>
</body>
</html>
