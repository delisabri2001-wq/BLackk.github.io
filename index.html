<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLack World | Community</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2d3436; --accent: #6c5ce7; --bg: #dfe6e9; --card: #ffffff; --text: #2d3436; --radius: 25px; }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; padding-bottom: 90px; }

        /* HEADER */
        header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* NAVIGAZIONE IN BASSO */
        nav { background: white; position: fixed; bottom: 0; width: 100%; height: 75px; display: flex; justify-content: space-around; align-items: center; border-top-left-radius: 20px; border-top-right-radius: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { text-align: center; color: #b2bec3; font-size: 0.7rem; cursor: pointer; transition: 0.3s; width: 25%; }
        .nav-item span { display: block; font-size: 1.6rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--accent); transform: translateY(-5px); }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -100%; top: 0; width: 300px; height: 100%; background: white; z-index: 2000; transition: 0.4s; padding: 30px; box-shadow: 10px 0 30px rgba(0,0,0,0.1); overflow-y: auto; }
        .sidebar.open { left: 0; }
        
        /* LAYOUT & CARDS */
        .container { max-width: 800px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; border-radius: var(--radius); padding: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.5); }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* INPUTS & BUTTONS */
        input, textarea, select { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 15px; margin-bottom: 10px; background: #f8f9fa; outline: none; transition: 0.3s; font-size: 0.9rem; }
        input:focus { border-color: var(--accent); background: white; }
        label { font-weight: 600; font-size: 0.85rem; margin-left: 5px; color: #636e72; display:block; margin-top:10px;}

        .btn-main { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 5px; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); }
        .btn-social-login { background: white; border: 2px solid #dfe6e9; color: #2d3436; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* CHAT & AMICI */
        #chatBox { height: 400px; overflow-y: auto; padding: 15px; background: #f1f2f6; border-radius: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 10px 15px; border-radius: 15px; background: white; max-width: 80%; font-size: 0.9rem; position: relative; }
        .msg.me { align-self: flex-end; background: var(--accent); color: white; border-bottom-right-radius: 5px; }
        .msg-user { font-size: 0.75rem; font-weight: bold; margin-bottom: 3px; display: block; opacity: 0.7; }

        .friend-card { background: white; padding: 20px; border-radius: 20px; margin-bottom: 15px; display: flex; gap: 15px; align-items: flex-start; position: relative; overflow: hidden; border:1px solid #eee; }
        .friend-card.match::after { content: "üíñ MATCH"; position: absolute; top: 0; right: 0; background: #ff7675; color: white; padding: 5px 10px; font-size: 0.7rem; border-bottom-left-radius: 15px; font-weight: bold; }
        .social-link { display: inline-block; margin-top: 8px; font-size: 0.8rem; color: var(--accent); text-decoration: none; font-weight: bold; background: #f1f2f6; padding: 5px 10px; border-radius: 8px; }

        /* QUIZ */
        .quiz-btn { width: 100%; padding: 15px; border: 2px solid #eee; background: white; border-radius: 15px; margin-bottom: 8px; cursor: pointer; text-align: left; font-weight: 600; transition: 0.2s; }
        .quiz-btn.correct { background: #00b894; color: white; border-color: #00b894; }
        .quiz-btn.wrong { background: #d63031; color: white; border-color: #d63031; }

        /* --- STILI LEGALI (Nuovi) --- */
        #cookieBanner { position: fixed; bottom: 85px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; background: #2d3436; color: white; padding: 15px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 4000; display: none; font-size: 0.8rem; text-align: center; }
        #privacyModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 5000; padding: 25px; overflow-y: auto; color: #333; }
        .legal-link { color: #636e72; text-decoration: underline; cursor: pointer; font-size: 0.8rem; display: block; margin-top: 15px; }

        /* TOAST */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2d3436; color: white; padding: 12px 25px; border-radius: 50px; display: none; z-index: 3000; font-size: 0.9rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<header>
    <div style="display:flex; justify-content:space-between; align-items:center; max-width:800px; margin:0 auto;">
        <div style="font-weight:800; font-size:1.2rem;">BLACK WORLD üåà</div>
        <div onclick="toggleSidebar()" style="cursor:pointer; font-size:1.5rem;">‚öôÔ∏è</div>
    </div>
</header>

<div id="toast">Notifica</div>

<div id="cookieBanner">
    <p style="margin-bottom:10px;">üç™ Questo sito usa cookie tecnici e Firebase per funzionare. Continuando accetti la nostra Policy.</p>
    <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn-main" style="padding:8px; margin:0; width:auto; font-size:0.8rem;" onclick="acceptCookies()">ACCETTA</button>
        <button class="btn-main" style="background:#636e72; padding:8px; margin:0; width:auto; font-size:0.8rem;" onclick="openPrivacy()">LEGGI POLICY</button>
    </div>
</div>

<div class="sidebar" id="sidebar">
    <div style="display:flex; justify-content:space-between;">
        <h3>Impostazioni</h3>
        <span onclick="toggleSidebar()" style="font-size:1.5rem; cursor:pointer;">‚úï</span>
    </div>
    <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">Gestisci il tuo account</p>
    
    <div id="authButtons">
        <button class="btn-main btn-social-login" onclick="socialLogin()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20"> Accedi con Google
        </button>
        <button class="btn-main" style="background:#b2bec3; margin-top:10px;" onclick="switchAuth('login')">Accedi con Email</button>
        <button class="btn-main" style="background:transparent; border:1px solid #b2bec3; color:#666; margin-top:10px;" onclick="switchAuth('reg')">Registrati</button>
    </div>

    <div id="userSettings" style="display:none;">
        <p>Loggata come: <b id="sidebarEmail">...</b></p>
        <button class="btn-main" style="background:#ff7675;" onclick="logout()">ESCI</button>
        <button class="btn-main" style="background:transparent; color:#d63031; border:1px solid #d63031; margin-top:10px;" onclick="deleteAccount()">ELIMINA ACCOUNT</button>
    </div>

    <div id="emailForms" style="margin-top:20px; display:none;">
        <input type="email" id="authEmail" placeholder="Email">
        <input type="password" id="authPass" placeholder="Password">
        <button class="btn-main" onclick="processAuth()">VAI</button>
        <small onclick="toggleEmailForms()" style="display:block; margin-top:10px; cursor:pointer; text-decoration:underline;">Annulla</small>
    </div>

    <div style="margin-top:40px; border-top:1px solid #eee; padding-top:10px;">
        <span class="legal-link" onclick="openPrivacy()">üìú Privacy & Cookie Policy</span>
    </div>
</div>

<div id="privacyModal">
    <button onclick="closePrivacy()" style="float:right; font-size:2rem; border:none; background:none;">‚úï</button>
    <h2>Privacy Policy</h2>
    <p style="font-size:0.8rem; color:#666;">Ultimo aggiornamento: 2024</p>
    <div style="margin-top:20px; line-height:1.6;">
        <p>Benvenuta su <b>Black World</b>. Questa applicazione √® un progetto amatoriale a scopo ludico. Tuttavia, la tua privacy √® importante.</p>
        
        <h4>1. Chi siamo</h4>
        <p>Il titolare del trattamento √® l'amministratore del progetto "Black World". Il servizio √® ospitato su infrastruttura Google Firebase.</p>

        <h4>2. Quali dati raccogliamo</h4>
        <ul>
            <li><b>Dati di Account:</b> Email, ID univoco (per il login).</li>
            <li><b>Profilo Pubblico:</b> Nickname, Et√†, Ship preferita, Bio, Link Social, Foto profilo (se forniti volontariamente).</li>
            <li><b>Contenuti Generati:</b> Messaggi nella Chat Pubblica, Punteggi Quiz.</li>
            <li><b>Dati Tecnici:</b> Indirizzo IP, Cookie tecnici (necessari per il login e per ricordare il consenso).</li>
        </ul>

        <h4>3. Finalit√†</h4>
        <p>I dati servono esclusivamente per:</p>
        <ul>
            <li>Permettere l'accesso all'account.</li>
            <li>Mostrare il tuo profilo alle altre utenti nella sezione "Amicizia".</li>
            <li>Permettere l'uso della chat e salvare i punteggi.</li>
        </ul>

        <h4>4. I tuoi diritti</h4>
        <p>Puoi in qualsiasi momento:</p>
        <ul>
            <li>Accedere ai tuoi dati (andando su Profilo).</li>
            <li>Modificare i dati.</li>
            <li><b>Cancellare l'account:</b> Puoi farlo autonomamente dal tasto "Elimina Account" nelle Impostazioni. Questo rimuover√† i tuoi dati personali dai nostri sistemi.</li>
        </ul>

        <h4>5. Cookie</h4>
        <p>Utilizziamo solo cookie tecnici essenziali per l'autenticazione Firebase e per le preferenze utente (es. accettazione di questo banner).</p>
    </div>
    <button class="btn-main" style="margin-top:20px;" onclick="closePrivacy()">HO CAPITO</button>
</div>

<div class="container">
    
    <section id="home" class="page active">
        <div class="card" style="text-align:center;">
            <h2>Benvenuta! ‚ú®</h2>
            <p>Esplora la community BL italiana.</p>
            <div style="margin-top:20px; font-size:3rem;">üè≥Ô∏è‚Äçüåà</div>
            <p>Vai su <b>Profilo</b> per creare la tua scheda.</p>
        </div>
        
        <div class="card">
            <h3>üèÜ Top 5 Players</h3>
            <table style="width:100%; text-align:left;">
                <tbody id="leaderboardBody"></tbody>
            </table>
        </div>
    </section>

    <section id="amicizia" class="page">
        <div style="margin-bottom:15px; display:flex; gap:10px;">
            <input type="text" id="searchShip" placeholder="üîç Filtra per Ship..." style="margin:0;" onkeyup="loadFriends()">
        </div>
        <div id="friendsFeed">
            <p style="text-align:center; color:#999;">Caricamento...</p>
        </div>
    </section>

    <section id="chat" class="page">
        <div class="card" style="padding:10px;">
            <div id="chatBox"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="chatInput" placeholder="Scrivi un messaggio..." style="margin:0;">
                <button class="btn-main" style="width:50px; margin:0;" onclick="sendMsg()">‚û§</button>
            </div>
        </div>
    </section>

    <section id="giochi" class="page">
        <div id="quizMenu" class="card">
            <h3>Scegli la tua House üéÆ</h3>
            <p>Domande difficili e veritiere!</p>
            <button class="btn-main" style="background:#e17055;" onclick="startSpecificQuiz('gmmtv')">üè¢ QUIZ GMMTV</button>
            <button class="btn-main" style="background:#0984e3;" onclick="startSpecificQuiz('domundi')">üêâ QUIZ DOMUNDI</button>
            <p style="margin-top:20px; font-weight:bold;">I tuoi punti totali: <span id="scoreDisplay">0</span></p>
        </div>

        <div id="quizActive" class="card" style="display:none;">
            <button onclick="closeQuiz()" style="float:right; border:none; background:none; cursor:pointer;">‚úï Esci</button>
            <h3 id="qTitle">Domanda 1</h3>
            <p id="qText" style="font-size:1.1rem; margin-bottom:20px;">...</p>
            <div id="qOptions"></div>
            <p id="qFeedback" style="font-weight:bold; margin-top:10px;"></p>
        </div>
    </section>

    <section id="profilo" class="page">
        <div id="loginWarning" class="card" style="text-align:center;">
            <h3>üîí Accesso Richiesto</h3>
            <p>Devi accedere per creare il tuo profilo.</p>
            <button class="btn-main" onclick="toggleSidebar()">ACCEDI ORA</button>
        </div>

        <div id="myProfileEditor" class="card" style="display:none;">
            <div style="text-align:center; margin-bottom:20px;">
                <img id="previewAvatar" src="https://ui-avatars.com/api/?name=User" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:4px solid var(--accent);">
                <h3 id="previewName">Il tuo nome</h3>
            </div>
            <label>Link Foto Profilo (URL)</label>
            <input type="text" id="pAvatar" placeholder="Incolla link immagine..." onchange="updatePreview()">
            <label>Nickname</label>
            <input type="text" id="pNick" placeholder="Nickname" onkeyup="updatePreview()">
            <label>Et√†</label>
            <input type="number" id="pAge" placeholder="Anni">
            <label>Ship Preferita</label>
            <input type="text" id="pShip" placeholder="es: OhmNanon, FirstKhao">
            <label>Contatto Social</label>
            <input type="text" id="pSocial" placeholder="es: IG @tuonome">
            <label>La tua Bio</label>
            <textarea id="pStory" rows="3" placeholder="Scrivi qualcosa su di te..."></textarea>
            <button class="btn-main" onclick="saveProfile()">SALVA MODIFICHE üíæ</button>
        </div>
    </section>

</div>

<nav>
    <div class="nav-item active" onclick="navTo('home', this)"><span>üè†</span>Home</div>
    <div class="nav-item" onclick="navTo('amicizia', this)"><span>üëØ‚Äç‚ôÄÔ∏è</span>Amicizia</div>
    <div class="nav-item" onclick="navTo('chat', this)"><span>üí¨</span>Chat</div>
    <div class="nav-item" onclick="navTo('giochi', this)"><span>üéÆ</span>Giochi</div>
    <div class="nav-item" onclick="navTo('profilo', this)"><span>üë§</span>Profilo</div>
</nav>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAr4cM8wb7kSHpaFDGjlDZcm15t1LyL4Do",
      authDomain: "black-world-91efc.firebaseapp.com",
      databaseURL: "https://black-world-91efc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "black-world-91efc",
      storageBucket: "black-world-91efc.firebasestorage.app",
      messagingSenderId: "1075556185722",
      appId: "1:1075556185722:web:a18a5f3d7ef3b4862aedc3"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // --- LOGICA LEGALE & UI ---
    window.onload = function() {
        if(!localStorage.getItem('cookieConsent')) {
            document.getElementById('cookieBanner').style.display = 'block';
        }
        loadLeaderboard();
    }
    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'true');
        document.getElementById('cookieBanner').style.display = 'none';
    }
    function openPrivacy() { document.getElementById('privacyModal').style.display = 'block'; }
    function closePrivacy() { document.getElementById('privacyModal').style.display = 'none'; }

    function navTo(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(pageId === 'amicizia') loadFriends();
        if(pageId === 'home') loadLeaderboard();
    }
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

    // --- AUTH ---
    let authMode = 'login';
    function switchAuth(mode) {
        authMode = mode;
        document.getElementById('authButtons').style.display = 'none';
        document.getElementById('emailForms').style.display = 'block';
    }
    function toggleEmailForms() {
        document.getElementById('authButtons').style.display = 'block';
        document.getElementById('emailForms').style.display = 'none';
    }
    function processAuth() {
        const e = document.getElementById('authEmail').value;
        const p = document.getElementById('authPass').value;
        if(authMode === 'login') {
            auth.signInWithEmailAndPassword(e,p).then(()=>toggleSidebar()).catch(err=>alert(err.message));
        } else {
            auth.createUserWithEmailAndPassword(e,p).then(()=>toggleSidebar()).catch(err=>alert(err.message));
        }
    }
    function socialLogin() {
        auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(()=>toggleSidebar()).catch(e=>alert("Dominio non autorizzato! " + e.message));
    }
    function logout() { auth.signOut().then(()=>location.reload()); }
    function deleteAccount() {
        if(confirm("Sei sicura? I dati verranno persi.")) {
            // Rimuoviamo anche i dati dal database
            db.ref('users/' + auth.currentUser.uid).remove();
            auth.currentUser.delete().then(()=>location.reload());
        }
    }

    // --- STATE MONITOR ---
    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userSettings').style.display = 'block';
            document.getElementById('sidebarEmail').innerText = user.email;
            document.getElementById('loginWarning').style.display = 'none';
            document.getElementById('myProfileEditor').style.display = 'block';
            
            db.ref('users/'+user.uid).once('value').then(s => {
                if(s.exists()) {
                    const d = s.val();
                    document.getElementById('pNick').value = d.nick || "";
                    document.getElementById('pAge').value = d.age || "";
                    document.getElementById('pShip').value = d.ship || "";
                    document.getElementById('pStory').value = d.story || "";
                    document.getElementById('pAvatar').value = d.avatar || "";
                    document.getElementById('pSocial').value = d.social || "";
                    document.getElementById('scoreDisplay').innerText = d.score || 0;
                    updatePreview();
                }
            });
            loadChat(); loadLeaderboard();
        } else {
            document.getElementById('authButtons').style.display = 'block';
            document.getElementById('userSettings').style.display = 'none';
            document.getElementById('loginWarning').style.display = 'block';
            document.getElementById('myProfileEditor').style.display = 'none';
            loadChat(); loadLeaderboard();
        }
    });

    // --- PROFILE ---
    function updatePreview() {
        const url = document.getElementById('pAvatar').value;
        const nick = document.getElementById('pNick').value;
        document.getElementById('previewAvatar').src = url || `https://ui-avatars.com/api/?name=${nick || 'User'}`;
        document.getElementById('previewName').innerText = nick || "Il tuo nome";
    }
    function saveProfile() {
        const u = auth.currentUser;
        if(!u) return;
        const data = {
            nick: document.getElementById('pNick').value,
            age: document.getElementById('pAge').value,
            ship: document.getElementById('pShip').value,
            story: document.getElementById('pStory').value,
            avatar: document.getElementById('pAvatar').value,
            social: document.getElementById('pSocial').value,
            uid: u.uid
        };
        db.ref('users/'+u.uid).update(data).then(() => showToast("Profilo aggiornato! ‚úÖ"));
    }

    // --- FRIENDS ---
    function loadFriends() {
        const filter = document.getElementById('searchShip').value.toLowerCase();
        const feed = document.getElementById('friendsFeed');
        db.ref('users').on('value', s => {
            feed.innerHTML = "";
            let myShip = "";
            if(auth.currentUser) myShip = document.getElementById('pShip').value.toLowerCase(); 
            s.forEach(child => {
                const u = child.val();
                if(auth.currentUser && u.uid === auth.currentUser.uid) return;
                if(filter && !u.ship.toLowerCase().includes(filter)) return;
                const isMatch = myShip && u.ship && u.ship.toLowerCase().includes(myShip);
                const pic = u.avatar || `https://ui-avatars.com/api/?name=${u.nick}&background=random`;
                feed.innerHTML += `
                    <div class="friend-card ${isMatch ? 'match' : ''}">
                        <img src="${pic}" style="width:60px; height:60px; border-radius:50%; object-fit:cover;">
                        <div style="flex:1;">
                            <h4 style="margin:0;">${u.nick} <small style="color:#666;">${u.age ? u.age+' anni' : ''}</small></h4>
                            <div style="font-size:0.8rem; margin:5px 0;">
                                <span style="background:#dfe6e9; padding:2px 8px; border-radius:4px;">Ship: <b>${u.ship}</b></span>
                            </div>
                            <p style="font-size:0.8rem; color:#555; margin:5px 0;"><i>"${u.story || ''}"</i></p>
                            ${u.social ? `<a href="https://instagram.com/${u.social.replace('@','')}" target="_blank" class="social-link">üì∏ ${u.social}</a>` : ''}
                        </div>
                    </div>
                `;
            });
        });
    }

    // --- CHAT ---
    function loadChat() {
        db.ref('chat').limitToLast(20).on('value', s => {
            const b = document.getElementById('chatBox'); b.innerHTML = "";
            s.forEach(c => {
                const m = c.val();
                const isMe = auth.currentUser && m.uid === auth.currentUser.uid;
                b.innerHTML += `<div class="msg ${isMe ? 'me' : ''}"><span class="msg-user">${m.nick}</span>${m.text}</div>`;
            });
            b.scrollTop = b.scrollHeight;
        });
    }
    function sendMsg() {
        if(!auth.currentUser) return showToast("Accedi per scrivere!");
        const txt = document.getElementById('chatInput').value;
        if(!txt) return;
        const nick = document.getElementById('pNick').value || "Anonimo";
        db.ref('chat').push({text:txt, uid:auth.currentUser.uid, nick:nick});
        document.getElementById('chatInput').value = "";
    }

    // --- QUIZ ---
    const DB_QUIZ = {
        gmmtv: [
            { q: "Chi ha tradito chi in 'Bad Buddy' (trama)?", a: ["Le famiglie si odiano", "Pran ha tradito", "Pat ha baciato Ink"], c: 0 },
            { q: "Perch√© Ohm e Nanon non interagiscono pi√π?", a: ["Scelta personale non chiarita", "Nanon ha lasciato GMMTV", "Litigio pubblico"], c: 0 },
            { q: "In 'Not Me', chi sono i gemelli?", a: ["Black & White", "Sean & Yok", "Gram & Eugene"], c: 0 },
            { q: "In 'Only Friends', chi distrugge il matrimonio?", a: ["Boeing", "Sand", "Top"], c: 0 }
        ],
        domundi: [
            { q: "Perch√© Net e James si sono separati?", a: ["James vuole fare l'artista", "Hanno litigato", "Net ha cambiato agenzia"], c: 0 },
            { q: "Soprannome di Uea per King in 'Bed Friend'?", a: ["Gatto / P'Pervert", "Daddy", "Cucciolo"], c: 0 },
            { q: "Chi √® il partner di Tutor?", a: ["Yim", "NuNew", "Max"], c: 0 },
            { q: "Chi ha lasciato la Domundi nel 2024?", a: ["James", "Zee", "Tommy"], c: 0 }
        ]
    };
    let curQ = 0, curScore = 0, activeType = null;
    function startSpecificQuiz(type) {
        if(!auth.currentUser) return showToast("Accedi per salvare i punti!");
        activeType = type; curQ = 0; curScore = 0;
        document.getElementById('quizMenu').style.display = 'none';
        document.getElementById('quizActive').style.display = 'block';
        showQuestion();
    }
    function showQuestion() {
        const list = DB_QUIZ[activeType];
        if(curQ >= list.length) {
            alert("Quiz Finito! Punti guadagnati: " + curScore);
            closeQuiz();
            db.ref('users/'+auth.currentUser.uid+'/score').transaction(s => (s||0) + curScore);
            return;
        }
        const data = list[curQ];
        document.getElementById('qTitle').innerText = "Domanda " + (curQ+1);
        document.getElementById('qText').innerText = data.q;
        document.getElementById('qFeedback').innerText = "";
        const opts = document.getElementById('qOptions'); opts.innerHTML = "";
        data.a.forEach((ans, i) => {
            const btn = document.createElement('button');
            btn.className = "quiz-btn"; btn.innerText = ans;
            btn.onclick = () => checkAns(i, data.c, btn);
            opts.appendChild(btn);
        });
    }
    function checkAns(sel, corr, btn) {
        document.querySelectorAll('.quiz-btn').forEach(b => b.disabled=true);
        if(sel === corr) {
            btn.classList.add('correct'); document.getElementById('qFeedback').innerText = "‚úÖ GIUSTO!"; curScore++;
        } else {
            btn.classList.add('wrong'); document.getElementById('qFeedback').innerText = "‚ùå SBAGLIATO!";
        }
        setTimeout(() => { curQ++; showQuestion(); }, 1500);
    }
    function closeQuiz() {
        document.getElementById('quizMenu').style.display = 'block';
        document.getElementById('quizActive').style.display = 'none';
    }

    // --- LEADERBOARD ---
    function loadLeaderboard() {
        db.ref("users").orderByChild("score").limitToLast(5).on("value", s => {
            const t = document.getElementById("leaderboardBody"); t.innerHTML = "";
            let arr = [];
            s.forEach(c => arr.push({n: c.val().nick, s: c.val().score || 0}));
            arr.sort((a,b) => b.s - a.s);
            arr.forEach((p, i) => {
                t.innerHTML += `<tr><td style="padding:8px; border-bottom:1px solid #eee;"><b>#${i+1}</b> ${p.n}</td><td style="text-align:right;">${p.s} pts</td></tr>`;
            });
        });
    }
</script>
</body>
</html>
