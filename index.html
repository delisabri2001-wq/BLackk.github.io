<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLack World | Community</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1b4332; --accent: #2d6a4f; --soft: #f0f7f4; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background: var(--soft); color: #333; }

        header { background: var(--primary); color: white; padding: 30px; text-align: center; }
        nav { background: white; border-bottom: 1px solid #ddd; display: flex; justify-content: center; sticky: top; z-index: 1000; height: 55px; }
        .nav-links { display: flex; align-items: center; gap: 25px; }
        .nav-links a { text-decoration: none; color: #333; font-weight: 600; cursor: pointer; text-transform: uppercase; }

        /* SIDEBAR REGISTRAZIONE / ACCESSO */
        .sidebar { position: fixed; left: -100%; top: 0; width: 380px; height: 100%; background: white; z-index: 2000; transition: 0.4s; padding: 25px; box-shadow: 5px 0 25px rgba(0,0,0,0.1); overflow-y: auto; }
        .sidebar.open { left: 0; }
        .tab-btn { padding: 10px; cursor: pointer; border: none; background: #eee; flex: 1; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: white; }
        .auth-form { display: none; margin-top: 20px; }
        .auth-form.active { display: block; }

        .reg-field { margin-bottom: 12px; }
        .reg-field label { display: block; font-size: 0.8rem; font-weight: 600; margin-bottom: 4px; }
        .reg-field input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }

        .btn-main { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-social { background: white; border: 1px solid #ddd; padding: 10px; width: 100%; margin-top: 10px; cursor: pointer; border-radius: 4px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 600; }
        .btn-social img { width: 18px; }

        /* CONTENT */
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .page { display: none; }
        .page.active { display: block; }

        #chatBox { height: 350px; overflow-y: auto; border: 1px solid #eee; padding: 15px; background: #fdfdfd; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 8px; background: #f1f1f1; max-width: 80%; }
        .msg.me { align-self: flex-end; background: #d1e7dd; }

        .match-notify { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; }
    </style>
</head>
<body>

<header><h1>BLACK WORLD ðŸŒˆ</h1></header>

<nav>
    <div style="position: absolute; left: 20px; top: 15px; cursor: pointer; font-weight: bold;" onclick="toggleSidebar()">â˜° ACCEDI / REGISTRATI</div>
    <div class="nav-links">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('amicizia')">Amicizia</a>
        <a onclick="showPage('chat')">Chat</a>
        <a onclick="showPage('giochi')">Giochi</a>
    </div>
</nav>

<div class="sidebar" id="sidebar">
    <div style="text-align:right; cursor:pointer;" onclick="toggleSidebar()">âœ• CHIUDI</div>
    
    <div style="display:flex; margin-top:20px;">
        <button class="tab-btn active" id="tabL" onclick="switchTab('login')">ACCEDI</button>
        <button class="tab-btn" id="tabR" onclick="switchTab('reg')">REGISTRATI</button>
    </div>

    <div id="loginForm" class="auth-form active">
        <div class="reg-field"><label>Email</label><input type="email" id="lEmail"></div>
        <div class="reg-field"><label>Password</label><input type="password" id="lPass"></div>
        <button class="btn-main" onclick="loginEmail()">ACCEDI</button>
    </div>

    <div id="regForm" class="auth-form">
        <div class="reg-field"><label>Nome *</label><input type="text" id="rNome"></div>
        <div class="reg-field"><label>Email *</label><input type="email" id="rEmail"></div>
        <div class="reg-field"><label>Password *</label><input type="password" id="rPass"></div>
        <button class="btn-main" onclick="registerEmail()">CREA ACCOUNT</button>
    </div>

    <hr style="margin:25px 0;">
    <button class="btn-social" onclick="socialLogin('google')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Google
    </button>
    <button class="btn-social" onclick="socialLogin('microsoft')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg"> Microsoft
    </button>
</div>

<div class="container">
    <section id="home" class="page active">
        <div class="card"><h2>Ultime novitÃ  BL ðŸŒ¿</h2><p>Benvenuta nel blog ufficiale di BLack World.</p></div>
    </section>

    <section id="amicizia" class="page">
        <div id="matchBox" class="match-notify"></div>
        <div class="card">
            <h3>Matchmaking Ship ðŸŒˆ</h3>
            <input type="text" id="pNick" placeholder="Tuo Nickname">
            <input type="text" id="pShip" placeholder="La tua Ship (es: JoongDunk)">
            <textarea id="pBio" placeholder="La tua bio..."></textarea>
            <button class="btn-main" onclick="handleMatch()">CERCA MATCH</button>
        </div>
        <div id="profilesFeed"></div>
    </section>

    <section id="chat" class="page">
        <div class="card">
            <h3>Chat Live ðŸ’¬</h3>
            <div id="chatBox"></div>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <input type="text" id="chatInput" placeholder="Scrivi..." style="flex:1;">
                <button class="btn-main" style="width:100px; margin:0;" onclick="sendMsg()">Invia</button>
            </div>
        </div>
    </section>

    <section id="giochi" class="page">
        <div class="card">
            <h3>Quiz GMMTV ðŸŽ®</h3>
            <p>Sei una vera esperta? Mettiti alla prova!</p>
            <button class="btn-main" onclick="alert('Quiz in fase di caricamento...')">Inizia Quiz</button>
        </div>
    </section>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAr4cM8wb7kSHpaFDGjlDZcm15t1LyL4Do",
      authDomain: "black-world-91efc.firebaseapp.com",
      databaseURL: "https://black-world-91efc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "black-world-91efc",
      storageBucket: "black-world-91efc.firebasestorage.app",
      messagingSenderId: "1075556185722",
      appId: "1:1075556185722:web:a18a5f3d7ef3b4862aedc3",
      measurementId: "G-L1TH722CGE"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function showPage(id) { 
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function switchTab(t) {
        document.getElementById('loginForm').classList.toggle('active', t === 'login');
        document.getElementById('regForm').classList.toggle('active', t === 'reg');
        document.getElementById('tabL').classList.toggle('active', t === 'login');
        document.getElementById('tabR').classList.toggle('active', t === 'reg');
    }

    // AUTH
    function registerEmail() {
        const e = document.getElementById('rEmail').value;
        const p = document.getElementById('rPass').value;
        auth.createUserWithEmailAndPassword(e, p).then(() => toggleSidebar()).catch(err => alert(err.message));
    }
    function loginEmail() {
        const e = document.getElementById('lEmail').value;
        const p = document.getElementById('lPass').value;
        auth.signInWithEmailAndPassword(e, p).then(() => toggleSidebar()).catch(err => alert(err.message));
    }
    function socialLogin(type) {
        const provider = type === 'google' ? new firebase.auth.GoogleAuthProvider() : new firebase.auth.OAuthProvider('microsoft.com');
        auth.signInWithPopup(provider).then(() => toggleSidebar()).catch(err => alert(err.message));
    }

    // CHAT & AMICIZIA
    let profiles = [];
    auth.onAuthStateChanged(user => {
        if(user) {
            db.ref("messages/public").limitToLast(20).on("value", s => {
                const box = document.getElementById('chatBox'); box.innerHTML = "";
                s.forEach(m => {
                    box.innerHTML += `<div class="msg ${m.val().user === user.email ? 'me' : ''}"><b>${m.val().user.split('@')[0]}</b>: ${m.val().text}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
            db.ref("profiles").on("value", s => { profiles = []; s.forEach(p => profiles.push(p.val())); });
        }
    });

    function sendMsg() {
        const txt = document.getElementById('chatInput').value;
        if(txt && auth.currentUser) {
            db.ref("messages/public").push({ user: auth.currentUser.email, text: txt });
            document.getElementById('chatInput').value = "";
        }
    }

    function handleMatch() {
        const nick = document.getElementById('pNick').value;
        const ship = document.getElementById('pShip').value.trim().toLowerCase();
        if(!ship || !auth.currentUser) return alert("Accedi e inserisci la ship!");
        
        const match = profiles.find(p => p.ship.toLowerCase() === ship && p.nick !== nick);
        const box = document.getElementById('matchBox');
        box.style.display = "block";
        box.innerHTML = match ? `ðŸŽ‰ MATCH! Anche <b>${match.nick}</b> adora questa ship!` : "Profilo salvato!";
        db.ref("profiles/" + auth.currentUser.uid).set({ nick, ship, bio: document.getElementById('pBio').value });
    }
</script>
</body>
</html>
